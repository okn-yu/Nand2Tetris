# 第8章
・「プログラムフロー」「サブルーチン呼び出し」に関するバイトコードをHACKアセンブリコードに変換する変換器を実装する  

### プログラムフロー
・スタックの最上位の値を利用して条件分岐の判定  
・実装対象のコマンド：'label', 'goto', 'if-goto'の3つ  

### サブルーチン
・サブルーチンの呼び出しに伴うメモリ関連の処理（ハウスキーピング処理）をスタック上で実装  
・フレーム：サブルーチン単位。サブルーチンのローカル変数・引数・ワーキングスタック・メモリセグメントなど  
・グローバルスタック：現在のサブルーチンとそのリターンを待つ全てのサブルーチンのためのフレームを含むメモリ領域  
・実装対象のコマンド：'function', 'call', 'return'の3つ  
・ハウスキーピング処理をどのように実装するかは複数の選択肢がある  

### ブートストラップコード
・スタックはRAM[256]以降に設定し、Sys.init()を呼び出すブートストラップコードを実装  
・Sys.init内でMain.main()を呼び出す    

### 感想
・サブルーチン呼び出しはデバックが大変(涙)で8章は苦戦した。最終的にはVMのメモリを目視確認してデバックした  
・ハウスキーピング処理は発想がCPUのコンテキストスイッチに似ている  
・テストプログラム毎にSPの値の設定やSys.initの呼び出しの有無など必要となる初期化処理が異なる。そのため対象テストプログラム毎に微妙なコードの修正が発生  