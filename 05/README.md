# 第5章
CPUおよびコンピュータ全体の回路を実装する  

### コンピュータ全体の回路
・命令メモリ/CPU/データメモリからなる  
・プログラム内蔵方式なので命令もデータの一部として扱われる  
・入出力はメモリマップドIO方式。割り込みは実装しない  
・キーボードの読み込みはアプリ側で無限ループ内のメモリ読み込みで対応    

### CPU実装の指針
一番複雑なのは実はPCでそれ意外はほぼ一発で書ける。教育的配慮でそのように機械語やALUを実装したのだろう  
  
- A命令  
・A命令でAレジスタに値が保存されるので、Aレジスタ直前のMuxのセレクタは命令の最上位ビット    
・Aレジスタのloadフラグも同じく命令の最上位ビット    

- C命令  
・C命令ではAレジスタにはALUの出力結果が入る  
・Aレジスタ更新はALUの出力先がAレジスタの場合  
・Aレジスタのloadフラグに上記の条件を追加  

- ALU  
・直前のMuxのセレクタはC命令のaビットで一発  
・ALUの制御ビットはC命令のc1からc6ビットで一発  

- PC  
・ALUの出力するフラグおよびC命令のdビットを用いる  

### 感想
・CPU実装は難しく最初はギブアップしてgithub上の実装を参考にした  
・2週目に読み直してようやく演繹的に実装することができた   