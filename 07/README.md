# 第7章
・「算術」「メモリアクセス」に関する中間言語をHACK言語に変換する変換器を実装する  

### コンパイラの全体図
・バイトコードをHack機械語に変換する変換器を7章/8章で作成  
・高級水準言語(Jack)をバイトコードに変換するコンパイラを10章/11章で作成  

### 仮想マシンの分類
・Wikipediaによるとシステム仮想マシンとプロセス仮想マシンがある  
・プログラミング言語の実行環境としての仮想マシンはプロセス仮想マシンを指す  

### 仮想マシンの実装方法 
・インタプリタ  
・専用ハードウェア  
・対象プラットフォームの機械語  

### プロセス仮想マシンの分類
・スタック仮想マシンとレジスタ仮想マシンの2種類  
・それぞれ一長一短  
・今回はJVMと同じくスタック仮想マシンを実装

### 標準マッピング
・VM変換器の実装において、プラットフォーム上でRAMの利用方法・レジスタの利用方法・セグメントの利用方法・シンボルの利用方法に関しては任意  
・それらの利用方法を「標準マッピング」として明確化  
・各セグメント間で値の移動をするには必ずスタック領域を経るスタック操作が必要  

### 標準マッピングに基づいたRAMの使用法
・0-15：仮想レジスタ  
・16-255：スタティック変数  
・265-2047：スタック  
・2048-16383：ヒープ  
・16384-24575：メモリマップドIO  
・24576-32767：使用しないメモリ領域  

ヒープ領域  
・オブジェクトと配列を格納するためのRAMの専用領域  
  
### 標準マッピングに基づいたレジスタの使用法
・RAM[0]：SP　スタックポインタ：スタック最上位の次を指す  
・RAM[1]：LCL　現在のVM関数におけるlocalアドレスのベースアドレス  
・RAM[2]：ARG　現在のVM関数内におけるargumentセグメントのベースアドレスを指す  
・RAM[3]：THIS　現在のヒープ内におけるthisセグメントのベースアドレスを指す  
・RAM[4]：THAT　現在のヒープ内におけるthatセグメントのベースアドレスを指す  
・RAM[5-12]：tempセグメントの値を保持  
・RAM[13-15]  

### 注意
・pointerセグメントでthisとthatの違いは、対象が配列かオブジェクトかどうか  
・pop pointer 0 はthisレジスタ  
・pop pointer 1 はthatレジスタ  
・これ以降thisやthatにindexを指定（＝アドレスを直接指定）してpop/pushすることは、対象オブジェクトのアドレスを「直接」さしているので、対象オブジェクトの操作  
  
### 感想
・任意の高級水準言語のプログラム(算術命令・論理命令)をスタック操作に還元できるという事実に驚愕した!!